service: videocloud

resources:
  Resources:
    VideoCloudDB:
      Type: 'AWS::RDS::DBInstance'
      Properties: 
        AllocatedStorage: '5'
        DBInstanceClass: db.t2.micro
        DBInstanceIdentifier: videocloud
        Engine: postgres
        DBName: ${self:custom.secrets.DB_NAME}
        MasterUsername: ${self:custom.secrets.DB_USER}
        MasterUserPassword: ${self:custom.secrets.DB_PASS}

provider:
  name: aws
  runtime: nodejs10.x
  stage: ${self:custom.secrets.NODE_ENV}
  region: eu-central-1
  environment:
    NODE_ENV: ${self:custom.secrets.NODE_ENV}
    DB_HOST: ${self:custom.secrets.DB_HOST}
    DB_NAME: ${self:custom.secrets.DB_NAME}
    DB_USER: ${self:custom.secrets.DB_USER}
    DB_PASS: ${self:custom.secrets.DB_PASS}

functions:
  server:
    handler: index.server
    events:
        - http: ANY /
        - http: ANY /{proxy+}

plugins:
  - serverless-apigw-binary

custom:
    secrets: ${file(secrets.json)}
    apigwBinary:
        types:
            - "*/*"
